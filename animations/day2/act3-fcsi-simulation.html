<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Drone ‚Äî Flight Controller & ESCs Simulation</title>
<style>
  :root{
    --bg: #fafafa;
    --card: #ffffff;
    --brain: #1a1a1a;
    --sensor: #3a3a3a;
    --signal: #6a6a6a;
    --power: #0a0a0a;
    --esc: #3a3a3a;
    --motor: #1a1a1a;
    --muted: #6a6a6a;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }

  html,body{
    height:100%;
    margin:0;
    background: #fafafa;
    color:#0a0a0a;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:40px 20px;
  }

  .container{
    width:100%;
    max-width:1100px;
    background: white;
    padding:28px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    border:2px solid #d0d0d0;
  }

  .top-row{display:flex; gap:16px; align-items:center; justify-content:space-between; margin-bottom:16px; flex-wrap:wrap;}
  h1{font-size:28px; margin:0; font-weight:400; color:#0a0a0a;}
  .controls{display:flex; gap:10px; align-items:center;}
  button{background:#1a1a1a; border:2px solid #1a1a1a; color:white; font-weight:600; padding:12px 16px; cursor:pointer; transition:all 0.3s;}
  button:hover{background:#000000; transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.3);}
  button.ghost{background:white; border:2px solid #d0d0d0; color:#0a0a0a;}
  button.ghost:hover{background:#f0f0f0; border-color:#9a9a9a;}
  .legend{color:var(--muted); font-size:14px; margin-top:8px;}

  /* svg stage */
  .stage{width:100%; height:560px; background: #f5f5f5; display:block; margin:20px auto; border:2px solid #9a9a9a;}

  /* labels */
  .label{font-size:13px; fill:#3a3a3a; pointer-events:none; font-weight:600;}

  /* stroke animations using dasharray */
  .flow {
    stroke-width:3;
    stroke-linecap:round;
    fill:none;
    stroke-dasharray: 8 8;
    stroke-dashoffset: 1000;
    transition: stroke-dashoffset 900ms linear;
  }
  .flow.animate { stroke-dashoffset: 0; }

  /* glowing pulses */
  .pulse {
    filter: drop-shadow(0 6px 18px rgba(0,0,0,0.6));
    transition: transform 280ms ease, opacity 280ms ease;
  }
  .pulse.on { transform: scale(1.08); opacity:1; }

  /* motor spin base - FIXED: Each prop rotates around its own center */
  .prop { 
    transform-origin: 50% 50%;
    transform-box: fill-box;
    transition: transform 200ms linear; 
  }
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }
  .spin-slow { animation: spin 1.2s linear infinite; }
  .spin-normal { animation: spin 0.7s linear infinite; }
  .spin-fast { animation: spin 0.28s linear infinite; }

  /* ESC box style - ENHANCED */
  .esc-box { 
    rx:3; 
    fill: #d0d0d0; 
    stroke: #3a3a3a; 
    stroke-width:2.5;
    transition: all 0.3s ease;
  }
  .esc-box.active {
    fill: #4CAF50;
    stroke: #2E7D32;
    filter: drop-shadow(0 0 8px rgba(76, 175, 80, 0.6));
  }
  .esc-label { font-size:10px; fill:#0a0a0a; font-weight:700; }
  .esc-value { font-size:9px; fill:#1a1a1a; font-weight:600; }

  @media (max-width:880px){
    .stage{height:480px;}
    .container{padding:20px;}
    h1{font-size:24px;}
  }
  @media (max-width:520px){
    .stage{height:400px;}
    .container{padding:16px;}
    h1{font-size:20px;}
    .top-row{flex-direction:column; align-items:flex-start; gap:10px;}
    .legend{font-size:13px;}
  }

  .explain {
    font-size:14px; color:#0a0a0a; margin-top:20px; display:flex; gap:12px; flex-wrap:wrap;
  }
  .pill{padding:10px 14px; background:#f5f5f5; border:1px solid #d0d0d0; font-weight:600; color:#3a3a3a;}
  .status { margin-left:auto; font-weight:700; color:#0a0a0a; }

</style>
</head>
<body>
  <div class="container">
    <div class="top-row">
      <div>
        <h1>"Brain & Muscles" ‚Äî Flight Controller + ESCs Animation</h1>
        <div class="legend">Click <strong>Trigger Wind</strong> to see how the flight controller reads sensors and commands ESCs to stabilize the drone.</div>
      </div>

      <div class="controls">
        <button id="windBtn">Trigger Wind</button>
        <button id="autoBtn" class="ghost">Auto Demo</button>
        <div class="status" id="statusText">Idle</div>
      </div>
    </div>

    <svg class="stage" viewBox="0 0 900 640" preserveAspectRatio="xMidYMid meet" aria-label="Drone animation stage" role="img">
      <defs>
        <linearGradient id="bgGrad" x1="0" x2="0" y1="0" y2="1">
          <stop offset="0" stop-color="#e0e0e0" stop-opacity="0.3"></stop>
          <stop offset="1" stop-color="#d0d0d0" stop-opacity="0.3"></stop>
        </linearGradient>
        <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
          <feGaussianBlur stdDeviation="4" result="b"/>
          <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
      </defs>

      <!-- wind arrow -->
      <g id="windGroup" opacity="0.0">
        <path id="windArrow" d="M820 160 C760 140,700 140,640 170" fill="none" stroke="#3a3a3a" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" opacity="0.95"></path>
        <polygon points="640,170 655,162 655,178" fill="#3a3a3a" />
        <text x="740" y="130" class="label" fill="#0a0a0a">Wind gust ‚Üí</text>
      </g>

      <!-- center: flight controller (brain) -->
      <g id="drone" transform="translate(450,320)">
        <!-- arms -->
        <g id="arms">
          <line id="armT" x1="0" y1="-0" x2="0" y2="-160" stroke="#9a9a9a" stroke-width="6" stroke-linecap="round"/>
          <line id="armR" x1="0" y1="0" x2="160" y2="0" stroke="#9a9a9a" stroke-width="6" stroke-linecap="round"/>
          <line id="armB" x1="0" y1="0" x2="0" y2="160" stroke="#9a9a9a" stroke-width="6" stroke-linecap="round"/>
          <line id="armL" x1="0" y1="0" x2="-160" y2="0" stroke="#9a9a9a" stroke-width="6" stroke-linecap="round"/>
        </g>

        <!-- REPOSITIONED ESCs - Now between FC and motors -->
        <!-- ESC for M1 (top) -->
        <g id="esc1Group" transform="translate(0,-80)">
          <rect x="-22" y="-14" width="44" height="28" class="esc-box" id="esc1" />
          <text x="0" y="-2" class="esc-label" text-anchor="middle">ESC1</text>
          <text x="0" y="8" class="esc-value" text-anchor="middle" id="esc1val">50%</text>
        </g>

        <!-- ESC for M2 (right) -->
        <g id="esc2Group" transform="translate(80,0)">
          <rect x="-22" y="-14" width="44" height="28" class="esc-box" id="esc2" />
          <text x="0" y="-2" class="esc-label" text-anchor="middle">ESC2</text>
          <text x="0" y="8" class="esc-value" text-anchor="middle" id="esc2val">50%</text>
        </g>

        <!-- ESC for M3 (bottom) -->
        <g id="esc3Group" transform="translate(0,80)">
          <rect x="-22" y="-14" width="44" height="28" class="esc-box" id="esc3" />
          <text x="0" y="-2" class="esc-label" text-anchor="middle">ESC3</text>
          <text x="0" y="8" class="esc-value" text-anchor="middle" id="esc3val">50%</text>
        </g>

        <!-- ESC for M4 (left) -->
        <g id="esc4Group" transform="translate(-80,0)">
          <rect x="-22" y="-14" width="44" height="28" class="esc-box" id="esc4" />
          <text x="0" y="-2" class="esc-label" text-anchor="middle">ESC4</text>
          <text x="0" y="8" class="esc-value" text-anchor="middle" id="esc4val">50%</text>
        </g>

        <!-- motors (props) -->
        <!-- top motor (M1) -->
        <g class="motorGroup" id="M1" transform="translate(0,-190)">
          <circle r="24" fill="#e0e0e0" stroke="#3a3a3a" stroke-width="2.5"></circle>
          <g class="prop spin-normal" id="prop1">
            <rect x="-3" y="-42" width="6" height="42" rx="3" fill="#1a1a1a" opacity="0.95"></rect>
            <rect x="-3" y="0" width="6" height="42" rx="3" fill="#1a1a1a" opacity="0.95"></rect>
          </g>
          <text x="0" y="50" class="label" text-anchor="middle">Motor 1</text>
        </g>

        <!-- right motor (M2) -->
        <g class="motorGroup" id="M2" transform="translate(190,0)">
          <circle r="24" fill="#e0e0e0" stroke="#3a3a3a" stroke-width="2.5"></circle>
          <g class="prop spin-normal" id="prop2">
            <rect x="-3" y="-42" width="6" height="42" rx="3" fill="#1a1a1a" opacity="0.95"></rect>
            <rect x="-3" y="0" width="6" height="42" rx="3" fill="#1a1a1a" opacity="0.95"></rect>
          </g>
          <text x="0" y="50" class="label" text-anchor="middle">Motor 2</text>
        </g>

        <!-- bottom motor (M3) -->
        <g class="motorGroup" id="M3" transform="translate(0,190)">
          <circle r="24" fill="#e0e0e0" stroke="#3a3a3a" stroke-width="2.5"></circle>
          <g class="prop spin-normal" id="prop3">
            <rect x="-3" y="-42" width="6" height="42" rx="3" fill="#1a1a1a" opacity="0.95"></rect>
            <rect x="-3" y="0" width="6" height="42" rx="3" fill="#1a1a1a" opacity="0.95"></rect>
          </g>
          <text x="0" y="50" class="label" text-anchor="middle">Motor 3</text>
        </g>

        <!-- left motor (M4) -->
        <g class="motorGroup" id="M4" transform="translate(-190,0)">
          <circle r="24" fill="#e0e0e0" stroke="#3a3a3a" stroke-width="2.5"></circle>
          <g class="prop spin-normal" id="prop4">
            <rect x="-3" y="-42" width="6" height="42" rx="3" fill="#1a1a1a" opacity="0.95"></rect>
            <rect x="-3" y="0" width="6" height="42" rx="3" fill="#1a1a1a" opacity="0.95"></rect>
          </g>
          <text x="0" y="50" class="label" text-anchor="middle">Motor 4</text>
        </g>

        <!-- central flight controller (brain) -->
        <g id="FC" transform="translate(0,0)">
          <circle r="38" fill="#f5f5f5" stroke="#1a1a1a" stroke-width="3" class="pulse" />
          <rect x="-42" y="-20" width="84" height="40" rx="4" fill="#e0e0e0" stroke="#9a9a9a" stroke-width="2"></rect>
          <text x="0" y="4" class="label" text-anchor="middle" font-weight="700" fill="#0a0a0a">Flight Controller</text>
          <text x="0" y="18" class="label" text-anchor="middle" font-size="10" fill="#3a3a3a">(IMU + Processor)</text>
        </g>

        <!-- sensor icon (gyro) -->
        <g id="Sensor" transform="translate(70,-24)" opacity="0.9">
          <circle r="14" fill="#e0e0e0" stroke="#3a3a3a" stroke-width="2"></circle>
          <text x="0" y="5" class="label" text-anchor="middle" font-size="10" fill="#0a0a0a">IMU</text>
        </g>
      </g>

      <!-- CORRECTED Paths - properly routed through ESCs -->
      <!-- sensor -> FC (blue) -->
      <path id="p_sensor_fc" class="flow" stroke="#2196F3" d="M520 283 C490 280,470 280,448 296" />

      <!-- FC -> ESCs (yellow/orange - PWM signals) -->
      <path id="p_fc_esc1" class="flow" stroke="#FF9800" d="M450 320 L450 240" />
      <path id="p_fc_esc2" class="flow" stroke="#FF9800" d="M450 320 L530 320" />
      <path id="p_fc_esc3" class="flow" stroke="#FF9800" d="M450 320 L450 400" />
      <path id="p_fc_esc4" class="flow" stroke="#FF9800" d="M450 320 L370 320" />

      <!-- ESC -> motors (red - power) -->
      <path id="p_esc1_m1" class="flow" stroke="#F44336" stroke-width="4" d="M450 226 L450 130" />
      <path id="p_esc2_m2" class="flow" stroke="#F44336" stroke-width="4" d="M544 320 L640 320" />
      <path id="p_esc3_m3" class="flow" stroke="#F44336" stroke-width="4" d="M450 414 L450 510" />
      <path id="p_esc4_m4" class="flow" stroke="#F44336" stroke-width="4" d="M356 320 L260 320" />

      <!-- explanatory floating text -->
      <text id="lbl1" x="480" y="220" class="label" opacity="0" fill="#2196F3">‚ë† IMU detects tilt</text>
      <text id="lbl2" x="480" y="280" class="label" opacity="0" fill="#FF9800">‚ë° FC calculates correction</text>
      <text id="lbl3" x="560" y="360" class="label" opacity="0" fill="#FF9800">‚ë¢ PWM signals to ESCs</text>
      <text id="lbl4" x="520" y="560" class="label" opacity="0" fill="#F44336">‚ë£ ESCs power motors</text>

    </svg>

    <div class="explain">
      <div class="pill">üß† Flight Controller ‚Äî Reads IMU & computes stabilization</div>
      <div class="pill">‚ö° ESCs ‚Äî Convert PWM signals to motor power</div>
      <div class="pill">üöÅ Motors ‚Äî Generate thrust for stability</div>
    </div>

  </div>

<script>
  const windBtn = document.getElementById('windBtn');
  const autoBtn = document.getElementById('autoBtn');
  const statusText = document.getElementById('statusText');

  const windGroup = document.getElementById('windGroup');
  const pSensorFC = document.getElementById('p_sensor_fc');
  const pFCtoESC = [
    document.getElementById('p_fc_esc1'),
    document.getElementById('p_fc_esc2'),
    document.getElementById('p_fc_esc3'),
    document.getElementById('p_fc_esc4'),
  ];
  const pESCtoMotor = [
    document.getElementById('p_esc1_m1'),
    document.getElementById('p_esc2_m2'),
    document.getElementById('p_esc3_m3'),
    document.getElementById('p_esc4_m4'),
  ];

  const FC = document.getElementById('FC');
  const Sensor = document.getElementById('Sensor');
  const lbls = [ 
    document.getElementById('lbl1'), 
    document.getElementById('lbl2'), 
    document.getElementById('lbl3'), 
    document.getElementById('lbl4') 
  ];

  const props = [
    document.getElementById('prop1'),
    document.getElementById('prop2'),
    document.getElementById('prop3'),
    document.getElementById('prop4')
  ];
  
  const escBoxes = [ 
    document.getElementById('esc1'), 
    document.getElementById('esc2'), 
    document.getElementById('esc3'), 
    document.getElementById('esc4') 
  ];
  
  const escValues = [
    document.getElementById('esc1val'),
    document.getElementById('esc2val'),
    document.getElementById('esc3val'),
    document.getElementById('esc4val')
  ];

  function resetVisuals(){
    windGroup.style.opacity = 0;
    [pSensorFC, ...pFCtoESC, ...pESCtoMotor].forEach(p=>{
      p.classList.remove('animate');
      p.style.strokeDashoffset = 1000;
      p.style.opacity = 0.2;
    });
    FC.querySelector('.pulse').classList.remove('on');
    lbls.forEach(l => l.style.opacity = 0);
    props.forEach(p => {
      p.classList.remove('spin-fast','spin-slow');
      p.classList.add('spin-normal');
    });
    escBoxes.forEach((e, i) => {
      e.classList.remove('active');
      escValues[i].textContent = '50%';
    });
    statusText.textContent = 'Idle';
  }

  async function demoSequence(){
    resetVisuals();
    statusText.textContent = 'üå¨Ô∏è Wind detected ‚Äî Drone tilts';
    
    windGroup.style.opacity = 1;
    windGroup.animate([{transform: 'translateX(0)'},{transform:'translateX(-12px)'}], {duration:800, easing:'ease-out'});
    
    const droneGroup = document.getElementById('drone');
    droneGroup.animate([
      { transform: 'translate(450px,320px) rotate(0deg)' }, 
      { transform: 'translate(450px,320px) rotate(-7deg)' }
    ], { duration: 700, fill:'forwards' });

    await wait(700);

    // Step 1: IMU detects tilt
    statusText.textContent = '‚ë† IMU detecting tilt...';
    pSensorFC.style.opacity = 1;
    animatePath(pSensorFC, 800);
    lbls[0].style.opacity = 1;
    Sensor.animate([{transform:'translate(70px,-24px) scale(1)'},{transform:'translate(70px,-24px) scale(1.15)'},{transform:'translate(70px,-24px) scale(1)'}], {duration:600});

    await wait(900);

    // Step 2: FC processes
    statusText.textContent = '‚ë° Flight Controller computing correction';
    FC.querySelector('.pulse').classList.add('on');
    FC.animate([{transform:'scale(1)'},{transform:'scale(1.08)'},{transform:'scale(1)'}], {duration:700});
    lbls[1].style.opacity = 1;
    
    await wait(800);

    // Step 3: FC sends PWM to ESCs
    statusText.textContent = '‚ë¢ Sending PWM signals to ESCs';
    lbls[2].style.opacity = 1;
    pFCtoESC.forEach((p,i)=> {
      p.style.opacity = 1;
      setTimeout(()=> animatePath(p, 600), i*120);
    });

    await wait(900);

    // Step 4: ESCs activate and send power
    statusText.textContent = '‚ë£ ESCs adjusting motor power';
    lbls[3].style.opacity = 1;
    
    // Corrective action: increase right motors, decrease left
    const throttleValues = [55, 75, 60, 35]; // M1, M2, M3, M4
    
    escBoxes.forEach((esc,i)=>{
      setTimeout(()=> {
        escBoxes[i].classList.add('active');
        escValues[i].textContent = throttleValues[i] + '%';
        pESCtoMotor[i].style.opacity = 1;
        animatePath(pESCtoMotor[i], 700);
      }, i*150);
    });

    await wait(1000);

    // Step 5: Motors respond
    statusText.textContent = '‚ö° Motors adjusting speed ‚Äî stabilizing';
    
    props.forEach((p, idx) => {
      p.classList.remove('spin-normal','spin-slow','spin-fast');
      if(idx === 1){ // M2 right -> fast
        p.classList.add('spin-fast');
      } else if(idx === 0 || idx === 2){ // M1, M3 -> normal
        p.classList.add('spin-normal');
      } else { // M4 left -> slow
        p.classList.add('spin-slow');
      }
    });

    droneGroup.animate([
      { transform: 'translate(450px,320px) rotate(-7deg)' }, 
      { transform: 'translate(450px,320px) rotate(0deg)' }
    ], { duration: 1000, easing:'ease-in-out', fill:'forwards' });

    await wait(1200);

    statusText.textContent = '‚úÖ Stabilized ‚Äî automatic correction complete';
    
    await wait(2000);
    
    // Reset to baseline
    escBoxes.forEach((e, i) => {
      e.classList.remove('active');
      escValues[i].textContent = '50%';
    });
    props.forEach(p => { 
      p.classList.remove('spin-slow','spin-fast'); 
      p.classList.add('spin-normal'); 
    });
  }

  function animatePath(pathEl, duration=800){
    const len = pathEl.getTotalLength();
    pathEl.style.strokeDasharray = `${len * 0.3} ${len}`;
    pathEl.style.strokeDashoffset = len;
    pathEl.classList.add('animate');
    pathEl.style.opacity = 1;
    
    setTimeout(()=> {
      pathEl.classList.remove('animate');
      pathEl.style.strokeDashoffset = 0;
    }, duration);
  }

  function wait(ms){ return new Promise(resolve => setTimeout(resolve, ms)); }

  windBtn.addEventListener('click', ()=> {
    demoSequence();
  });

  let autoInterval = null;
  autoBtn.addEventListener('click', () => {
    if(autoInterval){
      clearInterval(autoInterval);
      autoInterval = null;
      autoBtn.textContent = 'Auto Demo';
      resetVisuals();
    } else {
      autoBtn.textContent = 'Stop Auto';
      demoSequence();
      autoInterval = setInterval(()=> demoSequence(), 7000);
    }
  });

  props.forEach(p => p.classList.add('spin-normal'));
  resetVisuals();

</script>
</body>
</html>